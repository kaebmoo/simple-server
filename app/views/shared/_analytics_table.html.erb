<ul class="nav">
  <li class="nav-item">
    <a class="nav-link disabled" href="#">No ranking</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="#">Best follow-up rate</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="#">Best new registrations</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="#">Best BP control %</a>
  </li>
</ul>

<div class="card pr-0 pr-md-3">
    <div class="dropdown">
        <h3 class="dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="background: #fff;">
            All facilities
        </h3>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item" href="#">All facilities</a>
            <a class="dropdown-item" href="#">Community facilities (e.g. HWCs)</a> <!-- 'HWC' 'SAD'   -->
            <a class="dropdown-item" href="#">Small facilities (e.g. PHCs and RHs)</a> <!-- 'MPHC' 'PHC' 'RH' 'SAD' 'Standalone' `UHC` -->
            <a class="dropdown-item" href="#">Large facilities (e.g. CHCs, DHs, and CHs)</a> <!-- 'CH' 'CHC' 'DH' 'Hospital' 'SDH' --> 
        </div>
    </div>
    
    <div class="table-responsive table-compact">
        <table id="analytics-table">
          <colgroup>
              <col>
              <col style="border-left: 1px solid #dce4e8;">
              <col style="border-left: 1px solid #dce4e8;">
              <col>
              <col>
              <col style="border-left: 1px solid #dce4e8;">
              <col>
              <col>
              <col style="border-left: 1px solid #dce4e8;">
              <col>
              <col>
          </colgroup>
          <thead>
          <tr>
            <th>&nbsp;</th>
            <th class="row-label"><strong>Registered</strong></th>
            <th class="row-label" colspan="3"><strong>Follow-up patients</strong></th>
            <th class="row-label" colspan="3"><strong>New registrations</strong></th>
            <th class="row-label" colspan="3"><strong>Monthly cohort (registered in July)</strong></th>
          </tr>

          <tr data-sort-method="thead">
            <th class="row-label sort-label" style="text-align: left; padding: 8px 4px;">Name</th>
            <!--Registered patients-->
            <th class="row-label sort-label" style="padding: 8px 4px;" data-sort-method="number">Total</th>

            <!--Follow-up patients-->
            <% dates_for_periods(@period, 3).each do |period| %>
              <th class="row-label sort-label" style="padding: 8px 4px;" data-sort-method="number"><%= format_period(@period, period) %></th>
            <% end %>

            <!--New registrations-->
            <% dates_for_periods(@period, 3).each do |period| %>
              <th class="row-label sort-label" style="padding: 8px 4px;" data-sort-method="number"><%= format_period(@period, period) %></th>
            <% end %>

            <!--Last cohort -->
            <th class="row-label sort-label" style="padding: 8px 4px; text-transform: none;" data-sort-method="number">Didn't attend</th>
            <th class="row-label sort-label" style="padding: 8px 4px; text-transform: none;" data-sort-method="number">Uncontrolled</th>
            <th class="row-label sort-label" style="padding: 8px 4px; text-transform: none;" data-sort-method="number">Controlled</th>
            
          </tr>

          </thead>
          <tbody>

          <tr class="row-total" data-sort-method="none">
            <td class="row-title row-total">All</td>

            <!--Registered patients-->
            <td class="row-total" style="text-align: center;">
              <%= dash_if_zero(dashboard_analytics.sum { |_, row| row[:total_registered_patients] || 0 }) %>
            </td>

            <!--Follow-up patients-->
            <% dates_for_periods(@period, 3).each do |period| %>
              <td class="row-total" style="text-align: center;">
                <%= analytics_totals(dashboard_analytics, :follow_up_patients_by_period, period) %>
              </td>
            <% end %>

            <!--New registrations-->
            <% dates_for_periods(@period, 3).each do |period| %>
              <td class="row-total" style="text-align: center;">
                <%= analytics_totals(dashboard_analytics, :registered_patients_by_period, period) %>
              </td>
            <% end %>

            <!--Last cohort -->
              <td class="row-total" style="text-align: center;" colspan="3">
                &nbsp;
              </td>
          </tr>

          <% policy_scope(row_resource).each do |resource| %>
            <% if dashboard_analytics[resource.id].present? %>
              <tr>

                <td class="row-title">
                  <% if row_resource_link == :analytics_facility_path %>
                    <%= link_to resource.send(row_resource_display_field), send(row_resource_link, resource, period: @period) %>
                  <% else %>
                    <%= link_to resource.send(row_resource_display_field), send(row_resource_link, resource) %>
                  <% end %>
                </td>

                <!--Registered patients-->
                <td style="text-align: center;">
                  <%= dash_if_zero(dashboard_analytics.dig(resource.id, :total_registered_patients)) %>
                </td>

                <!--Follow-up patients-->
                <% dates_for_periods(@period, 3).each do |period| %>
                  <td style="text-align: center;">
                    <%= dash_if_zero(dashboard_analytics.dig(resource.id, :follow_up_patients_by_period, period)) %>
                  </td>
                <% end %>

                <!--New registrations-->
                <% dates_for_periods(@period, 3).each do |period| %>
                  <td style="text-align: center;">
                    <%= dash_if_zero(dashboard_analytics.dig(resource.id, :registered_patients_by_period, period)) %>
                  </td>
                <% end %>

                <!--Last cohort -->
                <td colspan="3" style="padding-top: 2px; padding-bottom: 0;">
                    <table class="split-bars split-bars-compact" style="margin: 0;">
                        <tbody>
                            <tr>
                                <td class="bar bar-1" data-toggle="tooltip" data-placement="top" data-trigger="hover focus click" title="" style="width: <%= rand(40..60) %>%;" data-original-title="96% didn't attend"><%= rand(70..140) %></td>
                                <td class="bar bar-2" data-toggle="tooltip" data-placement="top" data-trigger="hover focus click" title="" style="width: <%= rand(5..30) %>;" data-original-title="4% visited and uncontrolled"><%= rand(10..45) %></td>
                                <td class="bar bar-3" data-toggle="tooltip" data-placement="top" data-trigger="hover focus click" title="" style="width: auto;" data-original-title="0% visited and controlled"><%= rand(5..30) %></td>
                            </tr>
                        </tbody>
                    </table>
                </td>
              </tr>
            <% end %>
          <% end %>
          </tbody>
        </table>
      </div>
</div>
